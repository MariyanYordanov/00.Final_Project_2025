import{b as D,d as C,f as B,g as I,j as O,k as P,l as N,q as T,s as w}from"./chunk-AUDAITUP.js";import{a as A}from"./chunk-DMFGUMIH.js";import{a as k}from"./chunk-5V7HPQDU.js";import{a as S}from"./chunk-GVQVI2L6.js";import{e as _,k as x,x as M}from"./chunk-PT5BEB6V.js";import{Ab as n,Lb as v,Mb as b,Sa as o,Xa as d,Yb as F,_b as a,ac as g,cb as E,hb as p,xb as s,yb as i,zb as u}from"./chunk-AAMWR3CC.js";import{a as y,b as h}from"./chunk-4CLCTAJ7.js";function G(r,m){r&1&&(i(0,"div",35),a(1," \u0418\u043C\u0435\u0442\u043E \u0435 \u0437\u0430\u0434\u044A\u043B\u0436\u0438\u0442\u0435\u043B\u043D\u043E "),u())}function L(r,m){r&1&&(i(0,"div",35),a(1," \u0418\u043C\u0435\u0442\u043E \u0442\u0440\u044F\u0431\u0432\u0430 \u0434\u0430 \u0435 \u043F\u043E\u043D\u0435 3 \u0441\u0438\u043C\u0432\u043E\u043B\u0430 "),u())}function R(r,m){r&1&&n(0,"span",36)}function q(r,m){r&1&&n(0,"i",37)}function V(r,m){if(r&1&&(i(0,"div",38),n(1,"i",39),a(2),u()),r&2){let t=b();o(2),g(" ",t.successMessage," ")}}function U(r,m){if(r&1&&(i(0,"div",40),n(1,"i",41),a(2),u()),r&2){let t=b();o(2),g(" ",t.errorMessage," ")}}var j=class r{constructor(m,t,e,l,c){this.fb=m;this.familyService=t;this.memberService=e;this.authService=l;this.router=c}familyForm;isLoading=!1;successMessage="";errorMessage="";ngOnInit(){this.familyForm=this.fb.group({name:["",[C.required,C.minLength(3)]],description:[""],location:[""]})}onSubmit(){if(this.familyForm.invalid){this.markFormGroupTouched();return}this.isLoading=!0,this.errorMessage="",this.successMessage="";let m=h(y({},this.familyForm.value),{isPublic:!0});this.familyService.createFamily(m).subscribe({next:t=>{let e=this.authService.getCurrentUser();if(e){let l={firstName:e.firstName,middleName:e.middleName,lastName:e.lastName,gender:"Male",dateOfBirth:e.dateOfBirth,biography:"\u0421\u044A\u0437\u0434\u0430\u0442\u0435\u043B \u043D\u0430 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E\u0442\u043E",familyId:t.id};this.memberService.createMember(l).subscribe({next:()=>{this.successMessage="\u0421\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E\u0442\u043E \u0435 \u0441\u044A\u0437\u0434\u0430\u0434\u0435\u043D\u043E \u0443\u0441\u043F\u0435\u0448\u043D\u043E! \u0412\u0438\u0435 \u0441\u0442\u0435 \u0434\u043E\u0431\u0430\u0432\u0435\u043D\u0438 \u043A\u0430\u0442\u043E \u0447\u043B\u0435\u043D.",setTimeout(()=>{this.router.navigate(["/families",t.id])},2e3)},error:()=>{this.successMessage="\u0421\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E\u0442\u043E \u0435 \u0441\u044A\u0437\u0434\u0430\u0434\u0435\u043D\u043E \u0443\u0441\u043F\u0435\u0448\u043D\u043E!",setTimeout(()=>{this.router.navigate(["/families",t.id])},2e3)}})}else this.successMessage="\u0421\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E\u0442\u043E \u0435 \u0441\u044A\u0437\u0434\u0430\u0434\u0435\u043D\u043E \u0443\u0441\u043F\u0435\u0448\u043D\u043E!",setTimeout(()=>{this.router.navigate(["/families",t.id])},2e3)},error:t=>{console.error("Error creating family:",t),this.isLoading=!1,t.status===401?(this.errorMessage="\u041C\u043E\u043B\u044F, \u0432\u043B\u0435\u0437\u0442\u0435 \u0432 \u043F\u0440\u043E\u0444\u0438\u043B\u0430 \u0441\u0438",setTimeout(()=>{this.router.navigate(["/auth/login"])},2e3)):t.error?.errors?this.errorMessage=Object.values(t.error.errors).flat().join(", "):this.errorMessage="\u0413\u0440\u0435\u0448\u043A\u0430 \u043F\u0440\u0438 \u0441\u044A\u0437\u0434\u0430\u0432\u0430\u043D\u0435 \u043D\u0430 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E. \u041C\u043E\u043B\u044F \u043E\u043F\u0438\u0442\u0430\u0439\u0442\u0435 \u043E\u0442\u043D\u043E\u0432\u043E."}})}markFormGroupTouched(){Object.keys(this.familyForm.controls).forEach(m=>{this.familyForm.get(m)?.markAsTouched({onlySelf:!0})})}onCancel(){this.router.navigate(["/families"])}static \u0275fac=function(t){return new(t||r)(d(T),d(A),d(k),d(S),d(M))};static \u0275cmp=E({type:r,selectors:[["app-family-create-bootstrap"]],decls:53,vars:11,consts:[[1,"container","mt-4"],[1,"row","justify-content-center"],[1,"col-lg-8","col-md-10"],[1,"text-center","mb-5"],[1,"display-5","text-primary","mb-3"],[1,"fas","fa-plus-circle","me-3"],[1,"lead","text-muted"],[1,"card","border-0","shadow-lg"],[1,"card-header","bg-primary","text-white","text-center","py-4"],[1,"card-title","mb-0"],[1,"fas","fa-home","me-2"],[1,"card-body","p-5"],[3,"ngSubmit","formGroup"],[1,"mb-4"],[1,"form-label","fw-bold"],[1,"fas","fa-signature","me-2","text-primary"],["type","text","formControlName","name","placeholder","\u043D\u0430\u043F\u0440. \u0421\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E \u0418\u0432\u0430\u043D\u043E\u0432\u0438",1,"form-control","form-control-lg"],["class","invalid-feedback",4,"ngIf"],[1,"fas","fa-align-left","me-2","text-primary"],["formControlName","description","rows","4","placeholder","\u0414\u043E\u0431\u0430\u0432\u0435\u0442\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043D\u0430 \u0432\u0430\u0448\u0435\u0442\u043E \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E...",1,"form-control"],[1,"form-text"],[1,"fas","fa-info-circle","me-1"],[1,"fas","fa-map-marker-alt","me-2","text-primary"],["type","text","formControlName","location","placeholder","\u043D\u0430\u043F\u0440. \u0421\u043E\u0444\u0438\u044F, \u0411\u044A\u043B\u0433\u0430\u0440\u0438\u044F",1,"form-control"],[1,"alert","alert-info","d-flex","align-items-start","mb-4"],[1,"fas","fa-globe","me-3","mt-1"],[1,"mb-0","mt-1"],[1,"d-flex","gap-3","justify-content-end"],["type","button",1,"btn","btn-outline-secondary","btn-lg","px-4",3,"click"],[1,"fas","fa-times","me-2"],["type","submit",1,"btn","btn-primary","btn-lg","px-4",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","fas fa-plus me-2",4,"ngIf"],["class","alert alert-success mt-4 d-flex align-items-center",4,"ngIf"],["class","alert alert-danger mt-4 d-flex align-items-center",4,"ngIf"],[1,"invalid-feedback"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-plus","me-2"],[1,"alert","alert-success","mt-4","d-flex","align-items-center"],[1,"fas","fa-check-circle","me-2"],[1,"alert","alert-danger","mt-4","d-flex","align-items-center"],[1,"fas","fa-exclamation-triangle","me-2"]],template:function(t,e){if(t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),n(5,"i",5),a(6,"\u0421\u044A\u0437\u0434\u0430\u0439 \u043D\u043E\u0432\u043E \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E "),u(),i(7,"p",6),a(8,"\u0417\u0430\u043F\u043E\u0447\u043D\u0435\u0442\u0435 \u0432\u0430\u0448\u0430\u0442\u0430 \u0441\u0435\u043C\u0435\u0439\u043D\u0430 \u0438\u0441\u0442\u043E\u0440\u0438\u044F"),u()(),i(9,"div",7)(10,"div",8)(11,"h3",9),n(12,"i",10),a(13," \u0414\u0435\u0442\u0430\u0439\u043B\u0438 \u0437\u0430 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E\u0442\u043E "),u()(),i(14,"div",11)(15,"form",12),v("ngSubmit",function(){return e.onSubmit()}),i(16,"div",13)(17,"label",14),n(18,"i",15),a(19," \u0418\u043C\u0435 \u043D\u0430 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E\u0442\u043E * "),u(),n(20,"input",16),p(21,G,2,0,"div",17)(22,L,2,0,"div",17),u(),i(23,"div",13)(24,"label",14),n(25,"i",18),a(26," \u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 "),u(),n(27,"textarea",19),i(28,"div",20),n(29,"i",21),a(30," \u041E\u043F\u0446\u0438\u043E\u043D\u0430\u043B\u043D\u043E - \u043C\u043E\u0436\u0435\u0442\u0435 \u0434\u0430 \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u0435 \u0438\u0441\u0442\u043E\u0440\u0438\u044F \u0438\u043B\u0438 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u0437\u0430 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E\u0442\u043E "),u()(),i(31,"div",13)(32,"label",14),n(33,"i",22),a(34," \u041C\u0435\u0441\u0442\u043E\u043F\u043E\u043B\u043E\u0436\u0435\u043D\u0438\u0435 "),u(),n(35,"input",23),u(),i(36,"div",24),n(37,"i",25),i(38,"div")(39,"strong"),a(40,"\u0412\u0441\u0438\u0447\u043A\u0438 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u0430 \u0441\u0430 \u043F\u0443\u0431\u043B\u0438\u0447\u043D\u0438"),u(),i(41,"p",26),a(42,"\u0412\u0441\u0435\u043A\u0438 \u043C\u043E\u0436\u0435 \u0434\u0430 \u0440\u0430\u0437\u0433\u043B\u0435\u0436\u0434\u0430 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E\u0442\u043E, \u043D\u043E \u043B\u0438\u0447\u043D\u0438\u0442\u0435 \u0434\u0430\u043D\u043D\u0438 (\u0434\u0430\u0442\u0438 \u043D\u0430 \u0440\u0430\u0436\u0434\u0430\u043D\u0435) \u0441\u0430 \u0432\u0438\u0434\u0438\u043C\u0438 \u0441\u0430\u043C\u043E \u0437\u0430 \u0441\u044A\u0437\u0434\u0430\u0442\u0435\u043B\u044F."),u()()(),i(43,"div",27)(44,"button",28),v("click",function(){return e.onCancel()}),n(45,"i",29),a(46,"\u041E\u0442\u043A\u0430\u0437 "),u(),i(47,"button",30),p(48,R,1,0,"span",31)(49,q,1,0,"i",32),a(50),u()()()()(),p(51,V,3,1,"div",33)(52,U,3,1,"div",34),u()()()),t&2){let l,c,f;o(15),s("formGroup",e.familyForm),o(5),F("is-invalid",((l=e.familyForm.get("name"))==null?null:l.invalid)&&((l=e.familyForm.get("name"))==null?null:l.touched)),o(),s("ngIf",((c=e.familyForm.get("name"))==null?null:c.hasError("required"))&&((c=e.familyForm.get("name"))==null?null:c.touched)),o(),s("ngIf",((f=e.familyForm.get("name"))==null?null:f.hasError("minlength"))&&((f=e.familyForm.get("name"))==null?null:f.touched)),o(25),s("disabled",e.familyForm.invalid||e.isLoading),o(),s("ngIf",e.isLoading),o(),s("ngIf",!e.isLoading),o(),g(" ",e.isLoading?"\u0421\u044A\u0437\u0434\u0430\u0432\u0430\u043D\u0435...":"\u0421\u044A\u0437\u0434\u0430\u0439 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E"," "),o(),s("ngIf",e.successMessage),o(),s("ngIf",e.errorMessage)}},dependencies:[x,_,w,O,D,B,I,P,N],styles:[".card[_ngcontent-%COMP%]{border-radius:1rem;overflow:hidden}.card-header[_ngcontent-%COMP%]{border-radius:1rem 1rem 0 0!important}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:.75rem;border:2px solid #e9ecef;padding:.75rem 1rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#0d6efd;box-shadow:0 0 0 .25rem #0d6efd40}.form-label[_ngcontent-%COMP%]{color:#495057;margin-bottom:.75rem}.btn[_ngcontent-%COMP%]{border-radius:.75rem;font-weight:500;transition:all .3s ease}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(45deg,#0d6efd,#6610f2);border:none}.btn-primary[_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,#0b5ed7,#5a0fcf);transform:translateY(-1px)}.alert[_ngcontent-%COMP%]{border-radius:.75rem;border:none}.display-5[_ngcontent-%COMP%]{font-weight:600}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:0 15px}.card-body[_ngcontent-%COMP%]{padding:2rem!important}.d-flex.gap-3[_ngcontent-%COMP%]{flex-direction:column}.btn[_ngcontent-%COMP%]{width:100%}}"]})};export{j as FamilyCreateBootstrapComponent};

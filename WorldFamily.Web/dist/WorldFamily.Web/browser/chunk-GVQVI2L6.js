import{C as f,l as g,o as m}from"./chunk-PT5BEB6V.js";import{Ba as h,Q as n,U as p,Y as a,g as c}from"./chunk-AAMWR3CC.js";import{c as l}from"./chunk-4CLCTAJ7.js";var b=class o{constructor(e,t){this.http=e;if(this.isBrowser=g(t),this.isBrowser){let r=this.getToken();if(r&&!this.isTokenExpired(r)){let i=this.getUserFromStorage();i&&this.currentUserSubject.next(i)}else this.logout()}}API_URL=f.apiUrl;currentUserSubject=new c(null);currentUser$=this.currentUserSubject.asObservable();isBrowser;login(e){return this.http.post(`${this.API_URL}/api/auth/login`,e).pipe(n(t=>{this.setToken(t.token),this.setUser(t.user),this.currentUserSubject.next(t.user)}))}register(e){let u=e,{confirmPassword:t,dateOfBirth:r}=u,i=l(u,["confirmPassword","dateOfBirth"]);return this.http.post(`${this.API_URL}/api/auth/register`,i).pipe(n(s=>{s.token&&s.user&&(this.setToken(s.token),this.setUser(s.user),this.currentUserSubject.next(s.user))}))}logout(){this.isBrowser&&(localStorage.removeItem("token"),localStorage.removeItem("user")),this.currentUserSubject.next(null)}getToken(){return this.isBrowser?localStorage.getItem("token"):null}isAuthenticated(){if(!this.isBrowser)return!1;let e=this.getToken();return e!==null&&!this.isTokenExpired(e)}getCurrentUser(){return this.currentUserSubject.value}setToken(e){this.isBrowser&&localStorage.setItem("token",e)}setUser(e){this.isBrowser&&localStorage.setItem("user",JSON.stringify(e))}getUserFromStorage(){if(!this.isBrowser)return null;let e=localStorage.getItem("user");return e?JSON.parse(e):null}isTokenExpired(e){try{let r=JSON.parse(atob(e.split(".")[1])).exp*1e3;return Date.now()>=r}catch{return!0}}static \u0275fac=function(t){return new(t||o)(a(m),a(h))};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};export{b as a};

import{A as y,o as h}from"./chunk-Q7HNEB5Z.js";import{N as u,Q as s,U as b,Y as F,c as o,g as n,n as r,x as l,z as p}from"./chunk-AKCSPO7I.js";var d=class m{constructor(e){this.http=e}apiUrl=`${y.apiUrl}/api/family`;familiesSubject=new n([]);selectedFamilySubject=new n(null);families$=this.familiesSubject.asObservable();selectedFamily$=this.selectedFamilySubject.asObservable();getFamilies(){return this.http.get(this.apiUrl).pipe(s(e=>this.familiesSubject.next(e)),l(this.handleError("getFamilies",[])))}getFamilyById(e){return this.http.get(`${this.apiUrl}/${e}`).pipe(s(i=>this.selectedFamilySubject.next(i)),l(this.handleError("getFamilyById")))}createFamily(e){return this.http.post(this.apiUrl,e).pipe(s(i=>{let a=this.familiesSubject.value;this.familiesSubject.next([...a,i])}),l(this.handleError("createFamily")))}updateFamily(e,i){return this.http.put(`${this.apiUrl}/${e}`,i).pipe(s(a=>{let t=this.familiesSubject.value,c=t.findIndex(f=>f.id===e);c!==-1&&(t[c]=a,this.familiesSubject.next([...t])),this.selectedFamilySubject.value?.id===e&&this.selectedFamilySubject.next(a)}),l(this.handleError("updateFamily")))}deleteFamily(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(r(()=>{let a=this.familiesSubject.value.filter(t=>t.id!==e);return this.familiesSubject.next(a),this.selectedFamilySubject.value?.id===e&&this.selectedFamilySubject.next(null),!0}),l(this.handleError("deleteFamily",!1)))}searchFamilies(e){return e.pipe(p(300),u(i=>i.length===0?this.getFamilies():this.getFamilies().pipe(r(a=>a.filter(t=>t.name.toLowerCase().includes(i.toLowerCase())||t.description&&t.description.toLowerCase().includes(i.toLowerCase()))))))}getPublicFamilies(){return this.families$.pipe(r(e=>e.filter(i=>i.isPublic)))}getFeaturedFamilies(e=6){return this.getPublicFamilies().pipe(r(i=>i.sort((a,t)=>new Date(t.createdAt).getTime()-new Date(a.createdAt).getTime()).slice(0,e)))}clearSelectedFamily(){this.selectedFamilySubject.next(null)}handleError(e="operation",i){return a=>(console.error(`${e} failed: ${a.message}`),new o(t=>{i!==void 0&&t.next(i),t.complete()}))}static \u0275fac=function(i){return new(i||m)(F(h))};static \u0275prov=b({token:m,factory:m.\u0275fac,providedIn:"root"})};export{d as a};

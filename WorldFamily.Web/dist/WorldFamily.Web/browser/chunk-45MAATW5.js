import{h}from"./chunk-XTCHCJBU.js";import{o as c,s as p}from"./chunk-P3IMMIVJ.js";import{Ca as l,R as i,V as a,Z as o,g as u}from"./chunk-3PJXDOL5.js";var g=class s{constructor(e,t){this.http=e;if(this.isBrowser=c(t),this.isBrowser){let r=this.getToken();if(r&&!this.isTokenExpired(r)){let n=this.getUserFromStorage();n&&this.currentUserSubject.next(n)}else this.logout()}}API_URL=h.apiUrl;currentUserSubject=new u(null);currentUser$=this.currentUserSubject.asObservable();isBrowser;login(e){return this.http.post(`${this.API_URL}/auth/login`,e).pipe(i(t=>{this.setToken(t.token),this.setUser(t.user),this.currentUserSubject.next(t.user)}))}register(e){return this.http.post(`${this.API_URL}/auth/register`,e).pipe(i(t=>{this.setToken(t.token),this.setUser(t.user),this.currentUserSubject.next(t.user)}))}logout(){this.isBrowser&&(localStorage.removeItem("token"),localStorage.removeItem("user")),this.currentUserSubject.next(null)}getToken(){return this.isBrowser?localStorage.getItem("token"):null}isAuthenticated(){if(!this.isBrowser)return!1;let e=this.getToken();return e!==null&&!this.isTokenExpired(e)}getCurrentUser(){return this.currentUserSubject.value}setToken(e){this.isBrowser&&localStorage.setItem("token",e)}setUser(e){this.isBrowser&&localStorage.setItem("user",JSON.stringify(e))}getUserFromStorage(){if(!this.isBrowser)return null;let e=localStorage.getItem("user");return e?JSON.parse(e):null}isTokenExpired(e){try{let r=JSON.parse(atob(e.split(".")[1])).exp*1e3;return Date.now()>=r}catch{return!0}}static \u0275fac=function(t){return new(t||s)(o(p),o(l))};static \u0275prov=a({token:s,factory:s.\u0275fac,providedIn:"root"})};export{g as a};

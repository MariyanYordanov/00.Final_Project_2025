import{b as ee,d as T,f as te,g as ie,j as ne,k as re,l as ae,m as oe,n as ue,o as le,p as me,q as se,s as de}from"./chunk-J6HH3CIW.js";import{a as R}from"./chunk-CP6XCTAL.js";import{a as pe}from"./chunk-IVNTOVZQ.js";import{a as ce}from"./chunk-CQXCCY24.js";import{a as Z}from"./chunk-SLFAL3KE.js";import{d as B,e as O,h as K,i as Q,j as W,k as A,w as X}from"./chunk-Q7HNEB5Z.js";import{$b as f,D as V,Db as $,Eb as q,Gb as S,Kb as _,Lb as p,O as k,Ra as o,Vb as U,Wa as g,Xb as F,Zb as u,_b as v,ac as M,bb as C,bc as I,ca as h,da as y,f as G,gb as c,ib as w,ic as j,jc as D,kc as Y,lc as z,mc as H,oc as J,rb as E,t as P,wb as l,xb as r,yb as a,zb as d}from"./chunk-AKCSPO7I.js";import"./chunk-4CLCTAJ7.js";var L=(m=>(m[m.Parent=1]="Parent",m[m.Child=2]="Child",m[m.Spouse=3]="Spouse",m[m.Sibling=4]="Sibling",m[m.Grandparent=5]="Grandparent",m[m.Grandchild=6]="Grandchild",m[m.Uncle=7]="Uncle",m[m.Aunt=8]="Aunt",m[m.Nephew=9]="Nephew",m[m.Niece=10]="Niece",m[m.Cousin=11]="Cousin",m[m.GreatGrandparent=12]="GreatGrandparent",m[m.GreatGrandchild=13]="GreatGrandchild",m[m.StepParent=14]="StepParent",m[m.StepChild=15]="StepChild",m[m.StepSibling=16]="StepSibling",m[m.HalfSibling=17]="HalfSibling",m[m.Other=99]="Other",m))(L||{});function he(n,i){n&1&&(r(0,"div",33),u(1," \u041C\u043E\u043B\u044F \u0438\u0437\u0431\u0435\u0440\u0435\u0442\u0435 \u0442\u0438\u043F \u0432\u0440\u044A\u0437\u043A\u0430. "),a())}function ye(n,i){if(n&1&&(r(0,"option",17),u(1),r(2,"span",34),u(3),a()()),n&2){let e=i.$implicit;l("value",e.id),o(),I(" ",e.firstName," ",e.middleName," ",e.lastName," "),o(2),f("(",e.gender==="Male"?"\u041C\u044A\u0436":"\u0416\u0435\u043D\u0430",")")}}function Me(n,i){n&1&&(r(0,"div",33),u(1," \u041C\u043E\u043B\u044F \u0438\u0437\u0431\u0435\u0440\u0435\u0442\u0435 \u0440\u043E\u0434\u043D\u0438\u043D\u0430. "),a())}function xe(n,i){if(n&1&&(r(0,"div",35),d(1,"i",36),u(2),a()),n&2){let e=p();o(2),f(" ",e.errorMessage," ")}}function Ce(n,i){if(n&1&&(r(0,"div",37),d(1,"i",38),u(2),a()),n&2){let e=p();o(2),f(" ",e.successMessage," ")}}function Ee(n,i){n&1&&d(0,"span",39)}function Se(n,i){n&1&&d(0,"i",40)}var N=class n{constructor(i,e){this.fb=i;this.relationshipService=e;this.relationshipForm=this.fb.group({relationshipType:["",T.required],relatedMemberId:["",T.required],notes:[""]})}member1=null;familyMembers=[];modalId="addRelationshipModal";relationshipAdded=new w;relationshipError=new w;relationshipForm;isLoading=!1;errorMessage="";successMessage="";RelationshipType=L;get availableMembers(){return this.familyMembers.filter(i=>i.id!==this.member1?.id)}onSubmit(){if(this.relationshipForm.invalid||!this.member1){this.markFormGroupTouched();return}this.isLoading=!0,this.errorMessage="",this.successMessage="";let i=this.relationshipForm.value,e={primaryMemberId:this.member1.id,relatedMemberId:parseInt(i.relatedMemberId),relationshipType:i.relationshipType,notes:i.notes||void 0};this.relationshipService.createRelationship(e).pipe(V(()=>this.isLoading=!1)).subscribe({next:t=>{this.successMessage="\u0420\u043E\u0434\u043D\u0438\u043D\u0441\u043A\u0430\u0442\u0430 \u0432\u0440\u044A\u0437\u043A\u0430 \u0435 \u0434\u043E\u0431\u0430\u0432\u0435\u043D\u0430 \u0443\u0441\u043F\u0435\u0448\u043D\u043E!",this.relationshipForm.reset(),setTimeout(()=>{this.closeModal(),this.relationshipAdded.emit()},2e3)},error:t=>{console.error("Error creating relationship:",t),this.errorMessage=t.error?.message||"\u0413\u0440\u0435\u0448\u043A\u0430 \u043F\u0440\u0438 \u0434\u043E\u0431\u0430\u0432\u044F\u043D\u0435 \u043D\u0430 \u0432\u0440\u044A\u0437\u043A\u0430\u0442\u0430. \u041C\u043E\u043B\u044F \u043E\u043F\u0438\u0442\u0430\u0439\u0442\u0435 \u043E\u0442\u043D\u043E\u0432\u043E.",this.relationshipError.emit(this.errorMessage)}})}markFormGroupTouched(){Object.keys(this.relationshipForm.controls).forEach(i=>{this.relationshipForm.get(i)?.markAsTouched({onlySelf:!0})})}closeModal(){let i=document.getElementById(this.modalId);if(i){let e=window.bootstrap?.Modal?.getInstance(i);e&&e.hide()}}resetForm(){this.relationshipForm.reset(),this.errorMessage="",this.successMessage="",this.isLoading=!1}static \u0275fac=function(e){return new(e||n)(g(se),g(R))};static \u0275cmp=C({type:n,selectors:[["app-add-relationship-bootstrap"]],inputs:{member1:"member1",familyMembers:"familyMembers",modalId:"modalId"},outputs:{relationshipAdded:"relationshipAdded",relationshipError:"relationshipError"},decls:81,vars:31,consts:[["tabindex","-1","aria-hidden","true",1,"modal","fade",3,"id"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header","bg-primary","text-white"],[1,"modal-title",3,"id"],[1,"fas","fa-link","me-2"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close","btn-close-white"],[1,"modal-body"],[3,"ngSubmit","formGroup"],[1,"alert","alert-info","d-flex","align-items-start","mb-4"],[1,"fas","fa-info-circle","me-3","mt-1"],[1,"mb-0","mt-1"],[1,"mb-4"],[1,"form-label","fw-bold"],[1,"fas","fa-users","me-2"],["formControlName","relationshipType","required","",1,"form-select","form-select-lg"],["value",""],[3,"value"],["class","invalid-feedback",4,"ngIf"],[1,"fas","fa-user","me-2"],["formControlName","relatedMemberId","required","",1,"form-select","form-select-lg"],[3,"value",4,"ngFor","ngForOf"],[1,"form-label"],[1,"fas","fa-sticky-note","me-2"],["formControlName","notes","rows","3","placeholder","\u0414\u043E\u043F\u044A\u043B\u043D\u0438\u0442\u0435\u043B\u043D\u0430 \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u0437\u0430 \u0432\u0440\u044A\u0437\u043A\u0430\u0442\u0430...",1,"form-control"],["class","alert alert-danger d-flex align-items-center",4,"ngIf"],["class","alert alert-success d-flex align-items-center",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-outline-secondary",3,"disabled"],[1,"fas","fa-times","me-1"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],["class","fas fa-plus me-1",4,"ngIf"],[1,"invalid-feedback"],[1,"text-muted"],[1,"alert","alert-danger","d-flex","align-items-center"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"alert","alert-success","d-flex","align-items-center"],[1,"fas","fa-check-circle","me-2"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-plus","me-1"]],template:function(e,t){if(e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h5",4),d(5,"i",5),u(6," \u0414\u043E\u0431\u0430\u0432\u0438 \u0440\u043E\u0434\u043D\u0438\u043D\u0441\u043A\u0430 \u0432\u0440\u044A\u0437\u043A\u0430 "),a(),d(7,"button",6),a(),r(8,"div",7)(9,"form",8),_("ngSubmit",function(){return t.onSubmit()}),r(10,"div",9),d(11,"i",10),r(12,"div")(13,"strong"),u(14,"\u041E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u0442\u0435 \u0432\u0440\u044A\u0437\u043A\u0430\u0442\u0430"),a(),r(15,"p",11),u(16," \u0418\u0437\u0431\u0435\u0440\u0435\u0442\u0435 \u043A\u0430\u043A \u0441\u0435 \u0441\u0432\u044A\u0440\u0437\u0432\u0430 "),r(17,"strong"),u(18),a(),u(19," \u0441 \u0434\u0440\u0443\u0433 \u0447\u043B\u0435\u043D \u043E\u0442 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u043E\u0442\u043E. "),a()()(),r(20,"div",12)(21,"label",13),d(22,"i",14),u(23),a(),r(24,"select",15)(25,"option",16),u(26,"\u0418\u0437\u0431\u0435\u0440\u0435\u0442\u0435 \u0432\u0440\u044A\u0437\u043A\u0430"),a(),r(27,"option",17),u(28,"\u0440\u043E\u0434\u0438\u0442\u0435\u043B \u043D\u0430"),a(),r(29,"option",17),u(30,"\u0434\u0435\u0442\u0435 \u043D\u0430"),a(),r(31,"option",17),u(32,"\u0441\u044A\u043F\u0440\u0443\u0433/\u0441\u044A\u043F\u0440\u0443\u0433\u0430 \u043D\u0430"),a(),r(33,"option",17),u(34,"\u0431\u0440\u0430\u0442/\u0441\u0435\u0441\u0442\u0440\u0430 \u043D\u0430"),a(),r(35,"option",17),u(36,"\u0431\u0430\u0431\u0430/\u0434\u044F\u0434\u043E \u043D\u0430"),a(),r(37,"option",17),u(38,"\u0432\u043D\u0443\u043A/\u0432\u043D\u0443\u0447\u043A\u0430 \u043D\u0430"),a(),r(39,"option",17),u(40,"\u0447\u0438\u0447\u043E/\u0432\u0443\u0439\u0447\u043E \u043D\u0430"),a(),r(41,"option",17),u(42,"\u043B\u0435\u043B\u044F \u043D\u0430"),a(),r(43,"option",17),u(44,"\u043F\u043B\u0435\u043C\u0435\u043D\u043D\u0438\u043A \u043D\u0430"),a(),r(45,"option",17),u(46,"\u043F\u043B\u0435\u043C\u0435\u043D\u043D\u0438\u0446\u0430 \u043D\u0430"),a(),r(47,"option",17),u(48,"\u0431\u0440\u0430\u0442\u043E\u0432\u0447\u0435\u0434/\u0431\u0440\u0430\u0442\u043E\u0432\u0447\u0435\u0434\u043A\u0430 \u043D\u0430"),a(),r(49,"option",17),u(50,"\u0434\u043E\u0432\u0435\u0434\u0435\u043D \u0440\u043E\u0434\u0438\u0442\u0435\u043B \u043D\u0430"),a(),r(51,"option",17),u(52,"\u0434\u043E\u0432\u0435\u0434\u0435\u043D\u043E \u0434\u0435\u0442\u0435 \u043D\u0430"),a(),r(53,"option",17),u(54,"\u0434\u0440\u0443\u0433\u043E"),a()(),c(55,he,2,0,"div",18),a(),r(56,"div",12)(57,"label",13),d(58,"i",19),u(59," \u0420\u043E\u0434\u043D\u0438\u043D\u0430 "),a(),r(60,"select",20)(61,"option",16),u(62,"\u0418\u0437\u0431\u0435\u0440\u0435\u0442\u0435 \u0440\u043E\u0434\u043D\u0438\u043D\u0430"),a(),c(63,ye,4,5,"option",21),a(),c(64,Me,2,0,"div",18),a(),r(65,"div",12)(66,"label",22),d(67,"i",23),u(68," \u0411\u0435\u043B\u0435\u0436\u043A\u0438 (\u043F\u043E \u0438\u0437\u0431\u043E\u0440) "),a(),r(69,"textarea",24),u(70,"                "),a()(),c(71,xe,3,1,"div",25)(72,Ce,3,1,"div",26),a()(),r(73,"div",27)(74,"button",28),d(75,"i",29),u(76," \u041E\u0442\u043A\u0430\u0437 "),a(),r(77,"button",30),_("click",function(){return t.onSubmit()}),c(78,Ee,1,0,"span",31)(79,Se,1,0,"i",32),u(80),a()()()()()),e&2){let s,b;l("id",t.modalId),E("aria-labelledby",t.modalId+"Label"),o(4),l("id",t.modalId+"Label"),o(5),l("formGroup",t.relationshipForm),o(9),M("",t.member1==null?null:t.member1.firstName," ",t.member1==null?null:t.member1.lastName),o(5),f(" ",t.member1==null?null:t.member1.firstName," \u0435... "),o(4),l("value",t.RelationshipType.Parent),o(2),l("value",t.RelationshipType.Child),o(2),l("value",t.RelationshipType.Spouse),o(2),l("value",t.RelationshipType.Sibling),o(2),l("value",t.RelationshipType.Grandparent),o(2),l("value",t.RelationshipType.Grandchild),o(2),l("value",t.RelationshipType.Uncle),o(2),l("value",t.RelationshipType.Aunt),o(2),l("value",t.RelationshipType.Nephew),o(2),l("value",t.RelationshipType.Niece),o(2),l("value",t.RelationshipType.Cousin),o(2),l("value",t.RelationshipType.StepParent),o(2),l("value",t.RelationshipType.StepChild),o(2),l("value",t.RelationshipType.Other),o(2),l("ngIf",((s=t.relationshipForm.get("relationshipType"))==null?null:s.invalid)&&((s=t.relationshipForm.get("relationshipType"))==null?null:s.touched)),o(8),l("ngForOf",t.availableMembers),o(),l("ngIf",((b=t.relationshipForm.get("relatedMemberId"))==null?null:b.invalid)&&((b=t.relationshipForm.get("relatedMemberId"))==null?null:b.touched)),o(7),l("ngIf",t.errorMessage),o(),l("ngIf",t.successMessage),o(2),l("disabled",t.isLoading),o(3),l("disabled",t.relationshipForm.invalid||t.isLoading),o(),l("ngIf",t.isLoading),o(),l("ngIf",!t.isLoading),o(),f(" ",t.isLoading?"\u0414\u043E\u0431\u0430\u0432\u044F\u043D\u0435...":"\u0414\u043E\u0431\u0430\u0432\u0438 \u0432\u0440\u044A\u0437\u043A\u0430"," ")}},dependencies:[A,B,O,de,ne,ue,le,ee,oe,te,ie,me,re,ae],styles:[".modal-content[_ngcontent-%COMP%]{border-radius:1rem;border:none;box-shadow:0 1rem 3rem #0000002d}.modal-header[_ngcontent-%COMP%]{border-radius:1rem 1rem 0 0;padding:1.5rem}.modal-body[_ngcontent-%COMP%]{padding:2rem}.modal-footer[_ngcontent-%COMP%]{padding:1.5rem;border-top:1px solid #dee2e6}.form-select[_ngcontent-%COMP%], .form-control[_ngcontent-%COMP%]{border-radius:.75rem;border:2px solid #e9ecef;padding:.75rem 1rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-select[_ngcontent-%COMP%]:focus, .form-control[_ngcontent-%COMP%]:focus{border-color:#0d6efd;box-shadow:0 0 0 .25rem #0d6efd40}.form-label[_ngcontent-%COMP%]{color:#495057;margin-bottom:.75rem}.alert[_ngcontent-%COMP%]{border-radius:.75rem;border:none}.btn[_ngcontent-%COMP%]{border-radius:.5rem;padding:.75rem 1.5rem;font-weight:500}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(45deg,#0d6efd,#6610f2);border:none}.btn-primary[_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,#0b5ed7,#5a0fcf);transform:translateY(-1px)}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}.invalid-feedback[_ngcontent-%COMP%]{display:block}.form-select.is-invalid[_ngcontent-%COMP%], .form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}"]})};var Fe=n=>["/members",n];function Ie(n,i){n&1&&(r(0,"div",17)(1,"div",18)(2,"span",19),u(3,"\u0417\u0430\u0440\u0435\u0436\u0434\u0430\u043D\u0435..."),a()(),r(4,"p",20),u(5,"\u0417\u0430\u0440\u0435\u0436\u0434\u0430\u043D\u0435 \u043D\u0430 \u0440\u043E\u0434\u043D\u0438\u043D\u0438..."),a()())}function De(n,i){if(n&1){let e=S();r(0,"div",21),d(1,"i",22),u(2),r(3,"button",23),_("click",function(){h(e);let s=p();return y(s.loadMyMembers())}),d(4,"i",24),u(5,"\u041E\u043F\u0438\u0442\u0430\u0439\u0442\u0435 \u043E\u0442\u043D\u043E\u0432\u043E "),a()()}if(n&2){let e=p();o(2),f(" ",e.error," ")}}function Be(n,i){n&1&&(r(0,"div",17),d(1,"i",25),r(2,"h3",26),u(3,"\u041D\u044F\u043C\u0430 \u0440\u043E\u0434\u043D\u0438\u043D\u0438"),a(),r(4,"p",27),u(5,"\u0412\u0441\u0435 \u043E\u0449\u0435 \u043D\u044F\u043C\u0430 \u0434\u043E\u0431\u0430\u0432\u0435\u043D\u0438 \u0440\u043E\u0434\u043D\u0438\u043D\u0438 \u0432 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u0430\u0442\u0430."),a(),r(6,"a",28),d(7,"i",29),u(8,"\u0420\u0430\u0437\u0433\u043B\u0435\u0434\u0430\u0439 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u0430 "),a()())}function Oe(n,i){if(n&1&&(r(0,"li",34)(1,"button",35),d(2,"i",29),u(3),r(4,"span",36),u(5),a()()()),n&2){let e=i.$implicit,t=i.index;o(),F("active",t===0),l("id","family-tab-"+t),E("data-bs-target","#family-"+t),o(2),f(" ",e.family.name," "),o(2),v(e.members.length)}}function Ae(n,i){if(n&1&&(r(0,"span",56),u(1),a()),n&2){let e=p().$implicit,t=p(4);o(),f(" ",t.getAge(e.dateOfBirth)," \u0433\u043E\u0434. ")}}function Re(n,i){if(n&1&&(r(0,"div",57),d(1,"i",58),r(2,"small",26),u(3),D(4,"date"),a()()),n&2){let e=p().$implicit;o(3),v(z(4,1,e.dateOfBirth,"dd.MM.yyyy"))}}function Ne(n,i){if(n&1&&(r(0,"div",57),d(1,"i",59),r(2,"small",26),u(3),a()()),n&2){let e=p().$implicit;o(3),v(e.placeOfBirth)}}function Pe(n,i){if(n&1&&(r(0,"div",63)(1,"span",64),d(2,"i",65),u(3),a()()),n&2){let e=i.$implicit;o(3),M(" ",e.key,": ",e.value.join(", ")," ")}}function ke(n,i){if(n&1&&(r(0,"div",61),c(1,Pe,4,2,"div",62),a()),n&2){let e=p().$implicit;o(),l("ngForOf",e)}}function we(n,i){if(n&1&&($(0),c(1,ke,2,1,"div",60),q()),n&2){let e=i.$implicit;p();let t=U(18);o(),l("ngIf",e.length>0)("ngIfElse",t)}}function Te(n,i){n&1&&(r(0,"div",66),d(1,"i",67),u(2," \u0412\u0440\u044A\u0437\u043A\u0430 \u043D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430 "),a())}function Le(n,i){n&1&&(r(0,"span"),u(1,"..."),a())}function Ge(n,i){if(n&1&&(r(0,"p",68),u(1),D(2,"slice"),c(3,Le,2,0,"span",15),a()),n&2){let e=p().$implicit;o(),f(" ",H(2,2,e.biography,0,100)," "),o(2),l("ngIf",e.biography.length>100)}}function Ve(n,i){if(n&1){let e=S();r(0,"button",69),_("click",function(){h(e);let s=p().$implicit,b=p().$implicit,x=p(3);return y(x.selectMemberForRelationship(s,b.members))}),d(1,"i",70),u(2,"\u0414\u043E\u0431\u0430\u0432\u0438 \u0432\u0440\u044A\u0437\u043A\u0430 "),a()}}function $e(n,i){if(n&1&&(r(0,"div",40)(1,"div",41)(2,"div",42)(3,"h5",43),u(4),a(),r(5,"div",44),d(6,"i",45),r(7,"span",46),u(8),a(),c(9,Ae,2,1,"span",47),a()(),r(10,"div",48)(11,"div",49),c(12,Re,5,4,"div",50)(13,Ne,4,1,"div",50),a(),r(14,"div",49),c(15,we,2,2,"ng-container",15),D(16,"keyvalue"),c(17,Te,3,0,"ng-template",null,0,J),a(),c(19,Ge,4,6,"p",51),a(),r(20,"div",52)(21,"a",53),d(22,"i",54),u(23,"\u0414\u0435\u0442\u0430\u0439\u043B\u0438 "),a(),c(24,Ve,3,0,"button",55),a()()()),n&2){let e=i.$implicit,t=p().$implicit,s=p(3);o(4),I(" ",e.firstName," ",e.middleName," ",e.lastName," "),o(2),F("fa-mars",e.gender==="Male")("fa-venus",e.gender==="Female"),o(2),v(e.gender==="Male"?"\u041C\u044A\u0436":"\u0416\u0435\u043D\u0430"),o(),l("ngIf",e.dateOfBirth&&s.canViewBirthDate(t.family)),o(3),l("ngIf",e.dateOfBirth&&s.canViewBirthDate(t.family)),o(),l("ngIf",e.placeOfBirth),o(2),l("ngIf",Y(16,15,s.getGroupedRelationshipsForMember(e))),o(4),l("ngIf",e.biography),o(2),l("routerLink",j(17,Fe,e.id)),o(3),l("ngIf",s.canManageFamily(t.family))}}function qe(n,i){if(n&1&&(r(0,"div",37)(1,"div",4)(2,"h3",11),u(3),a(),r(4,"p",26),u(5),a()(),r(6,"div",38),c(7,$e,25,19,"div",39),a()()),n&2){let e=i.$implicit,t=i.index,s=p(3);F("show",t===0)("active",t===0),l("id","family-"+t),o(3),v(e.family.name),o(2),M(" ",e.members.length," ",e.members.length===1?"\u0440\u043E\u0434\u043D\u0438\u043D\u0430":"\u0440\u043E\u0434\u043D\u0438\u043D\u0438"," "),o(2),l("ngForOf",e.members)("ngForTrackBy",s.trackByMemberId)}}function Ue(n,i){if(n&1&&(r(0,"div")(1,"ul",30),c(2,Oe,6,6,"li",31),a(),r(3,"div",32),c(4,qe,8,10,"div",33),a()()),n&2){let e=p(2);o(2),l("ngForOf",e.familyMembers),o(2),l("ngForOf",e.familyMembers)}}function je(n,i){if(n&1&&(r(0,"div"),c(1,Be,9,0,"div",13)(2,Ue,5,2,"div",15),a()),n&2){let e=p();o(),l("ngIf",e.familyMembers.length===0),o(),l("ngIf",e.familyMembers.length>0)}}function Ye(n,i){if(n&1){let e=S();r(0,"app-add-relationship-bootstrap",71),_("relationshipAdded",function(){h(e);let s=p();return y(s.onRelationshipAdded())})("relationshipError",function(s){h(e);let b=p();return y(b.onRelationshipError(s))}),a()}if(n&2){let e=p();l("member1",e.selectedMember)("familyMembers",e.selectedFamilyMembers)}}var be=class n{constructor(i,e,t,s){this.familyService=i;this.memberService=e;this.authService=t;this.relationshipService=s}destroy$=new G;familyMembers=[];relationships=[];isLoading=!0;error=null;currentUserId=null;selectedMember=null;selectedFamilyMembers=[];ngOnInit(){let i=this.authService.getCurrentUser();this.currentUserId=i?.id||null,this.loadMyMembers()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadMyMembers(){this.isLoading=!0,this.error=null,this.familyService.getFamilies().pipe(k(this.destroy$)).subscribe({next:i=>{if(i.length===0){this.familyMembers=[],this.isLoading=!1;return}let e=i.map(t=>this.memberService.getMembersByFamily(t.id).pipe(k(this.destroy$)));P(e).subscribe({next:t=>{this.familyMembers=i.map((s,b)=>({family:s,members:t[b]||[]})).filter(s=>s.members.length>0),this.loadRelationships()},error:t=>{this.error="\u0413\u0440\u0435\u0448\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0440\u0435\u0436\u0434\u0430\u043D\u0435 \u043D\u0430 \u0440\u043E\u0434\u043D\u0438\u043D\u0438",this.isLoading=!1,console.error("Error loading members:",t)}})},error:i=>{this.error="\u0413\u0440\u0435\u0448\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0440\u0435\u0436\u0434\u0430\u043D\u0435 \u043D\u0430 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u0430",this.isLoading=!1,console.error("Error loading families:",i)}})}trackByMemberId(i,e){return e.id}getAge(i){let e=new Date,t=new Date(i),s=e.getFullYear()-t.getFullYear(),b=e.getMonth()-t.getMonth();return(b<0||b===0&&e.getDate()<t.getDate())&&s--,s}loadRelationships(){let e=this.familyMembers.map(t=>t.family.id).map(t=>this.relationshipService.getRelationshipsByFamily(t));e.length>0?P(e).subscribe({next:t=>{this.relationships=t.flat(),this.isLoading=!1},error:t=>{console.error("Error loading relationships:",t),this.isLoading=!1}}):this.isLoading=!1}getRelationshipsForMember(i){return this.relationships.filter(e=>e.primaryMemberId===i.id||e.relatedMemberId===i.id)}getGroupedRelationshipsForMember(i){let e=this.getRelationshipsForMember(i),t={};return e.forEach(s=>{let b=this.getRelationshipTypeForMember(s,i.id),x=this.getRelatedPersonName(s,i.id);b&&x&&(t[b]||(t[b]=[]),t[b].push(x))}),t}getRelationshipTypeForMember(i,e){let t={1:"\u0420\u043E\u0434\u0438\u0442\u0435\u043B \u043D\u0430",2:"\u0414\u0435\u0442\u0435 \u043D\u0430",3:"\u0421\u044A\u043F\u0440\u0443\u0433/\u0430 \u043D\u0430",4:"\u0411\u0440\u0430\u0442/\u0421\u0435\u0441\u0442\u0440\u0430 \u043D\u0430",5:"\u0411\u0430\u0431\u0430/\u0414\u044F\u0434\u043E \u043D\u0430",6:"\u0412\u043D\u0443\u043A/\u0412\u043D\u0443\u0447\u043A\u0430 \u043D\u0430",7:"\u0427\u0438\u0447\u043E/\u0412\u0443\u0439\u0447\u043E \u043D\u0430",8:"\u041B\u0435\u043B\u044F \u043D\u0430",9:"\u041F\u043B\u0435\u043C\u0435\u043D\u043D\u0438\u043A \u043D\u0430",10:"\u041F\u043B\u0435\u043C\u0435\u043D\u043D\u0438\u0446\u0430 \u043D\u0430",11:"\u0411\u0440\u0430\u0442\u043E\u0432\u0447\u0435\u0434/\u043A\u0430 \u043D\u0430",12:"\u041F\u0440\u0430\u0431\u0430\u0431\u0430/\u041F\u0440\u0430\u0434\u044F\u0434\u043E \u043D\u0430",13:"\u041F\u0440\u0430\u0432\u043D\u0443\u043A/\u043A\u0430 \u043D\u0430",14:"\u0414\u043E\u0432\u0435\u0434\u0435\u043D \u0440\u043E\u0434\u0438\u0442\u0435\u043B \u043D\u0430",15:"\u0414\u043E\u0432\u0435\u0434\u0435\u043D\u043E \u0434\u0435\u0442\u0435 \u043D\u0430",16:"\u0414\u043E\u0432\u0435\u0434\u0435\u043D \u0431\u0440\u0430\u0442/\u0441\u0435\u0441\u0442\u0440\u0430 \u043D\u0430",17:"\u041F\u043E\u043B\u0443\u0431\u0440\u0430\u0442/\u0441\u0435\u0441\u0442\u0440\u0430 \u043D\u0430",99:"\u0414\u0440\u0443\u0433\u043E"};return i.primaryMemberId===e?t[i.relationshipType]||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430 \u0432\u0440\u044A\u0437\u043A\u0430":this.getReverseRelationshipName(i.relationshipType)}getReverseRelationshipName(i){return{1:"\u0414\u0435\u0442\u0435 \u043D\u0430",2:"\u0420\u043E\u0434\u0438\u0442\u0435\u043B \u043D\u0430",3:"\u0421\u044A\u043F\u0440\u0443\u0433/\u0430 \u043D\u0430",4:"\u0411\u0440\u0430\u0442/\u0421\u0435\u0441\u0442\u0440\u0430 \u043D\u0430",5:"\u0412\u043D\u0443\u043A/\u0412\u043D\u0443\u0447\u043A\u0430 \u043D\u0430",6:"\u0411\u0430\u0431\u0430/\u0414\u044F\u0434\u043E \u043D\u0430",7:"\u041F\u043B\u0435\u043C\u0435\u043D\u043D\u0438\u043A/\u0446\u0430 \u043D\u0430",8:"\u041F\u043B\u0435\u043C\u0435\u043D\u043D\u0438\u043A/\u0446\u0430 \u043D\u0430",9:"\u0427\u0438\u0447\u043E/\u0412\u0443\u0439\u0447\u043E \u043D\u0430",10:"\u041B\u0435\u043B\u044F \u043D\u0430",11:"\u0411\u0440\u0430\u0442\u043E\u0432\u0447\u0435\u0434/\u043A\u0430 \u043D\u0430",12:"\u041F\u0440\u0430\u0432\u043D\u0443\u043A/\u043A\u0430 \u043D\u0430",13:"\u041F\u0440\u0430\u0431\u0430\u0431\u0430/\u041F\u0440\u0430\u0434\u044F\u0434\u043E \u043D\u0430",14:"\u0414\u043E\u0432\u0435\u0434\u0435\u043D\u043E \u0434\u0435\u0442\u0435 \u043D\u0430",15:"\u0414\u043E\u0432\u0435\u0434\u0435\u043D \u0440\u043E\u0434\u0438\u0442\u0435\u043B \u043D\u0430",16:"\u0414\u043E\u0432\u0435\u0434\u0435\u043D \u0431\u0440\u0430\u0442/\u0441\u0435\u0441\u0442\u0440\u0430 \u043D\u0430",17:"\u041F\u043E\u043B\u0443\u0431\u0440\u0430\u0442/\u0441\u0435\u0441\u0442\u0440\u0430 \u043D\u0430",99:"\u0414\u0440\u0443\u0433\u043E"}[i]||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430 \u0432\u0440\u044A\u0437\u043A\u0430"}getRelatedPersonName(i,e){return i.primaryMemberId===e?i.relatedMemberName||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u0435\u043D":i.primaryMemberName||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u0435\u043D"}getRelationshipDisplayText(i){return{1:"\u0420\u043E\u0434\u0438\u0442\u0435\u043B",2:"\u0414\u0435\u0442\u0435",3:"\u0421\u044A\u043F\u0440\u0443\u0433/\u0430",4:"\u0411\u0440\u0430\u0442/\u0421\u0435\u0441\u0442\u0440\u0430",5:"\u0411\u0430\u0431\u0430/\u0414\u044F\u0434\u043E",6:"\u0412\u043D\u0443\u043A/\u0412\u043D\u0443\u0447\u043A\u0430",7:"\u0427\u0438\u0447\u043E/\u0412\u0443\u0439\u0447\u043E",8:"\u041B\u0435\u043B\u044F",9:"\u041F\u043B\u0435\u043C\u0435\u043D\u043D\u0438\u043A",10:"\u041F\u043B\u0435\u043C\u0435\u043D\u043D\u0438\u0446\u0430",11:"\u0411\u0440\u0430\u0442\u043E\u0432\u0447\u0435\u0434/\u043A\u0430",12:"\u041F\u0440\u0430\u0431\u0430\u0431\u0430/\u041F\u0440\u0430\u0434\u044F\u0434\u043E",13:"\u041F\u0440\u0430\u0432\u043D\u0443\u043A/\u043A\u0430",14:"\u0414\u043E\u0432\u0435\u0434\u0435\u043D \u0440\u043E\u0434\u0438\u0442\u0435\u043B",15:"\u0414\u043E\u0432\u0435\u0434\u0435\u043D\u043E \u0434\u0435\u0442\u0435",16:"\u0414\u043E\u0432\u0435\u0434\u0435\u043D \u0431\u0440\u0430\u0442/\u0441\u0435\u0441\u0442\u0440\u0430",17:"\u041F\u043E\u043B\u0443\u0431\u0440\u0430\u0442/\u0441\u0435\u0441\u0442\u0440\u0430",99:"\u0414\u0440\u0443\u0433\u043E"}[i.relationshipType]||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430 \u0432\u0440\u044A\u0437\u043A\u0430"}selectMemberForRelationship(i,e){this.selectedMember=i,this.selectedFamilyMembers=e}onRelationshipAdded(){this.loadRelationships(),console.log("Relationship added successfully")}onRelationshipError(i){console.error("Relationship error:",i),alert("\u0413\u0440\u0435\u0448\u043A\u0430 \u043F\u0440\u0438 \u0434\u043E\u0431\u0430\u0432\u044F\u043D\u0435 \u043D\u0430 \u0432\u0440\u044A\u0437\u043A\u0430\u0442\u0430: "+i)}canManageFamily(i){return this.authService.getCurrentUser()?.id===i.createdByUserId}canViewBirthDate(i){return this.canManageFamily(i)}static \u0275fac=function(e){return new(e||n)(g(pe),g(ce),g(Z),g(R))};static \u0275cmp=C({type:n,selectors:[["app-my-members-bootstrap"]],decls:20,vars:4,consts:[["noRelationships",""],[1,"container","mt-4"],[1,"row"],[1,"col-12"],[1,"text-center","mb-4"],[1,"display-4","text-primary","mb-3"],[1,"fas","fa-users","me-3"],[1,"lead","text-muted"],[1,"card","border-0","bg-light","mb-4"],[1,"card-body","text-center","py-4"],[1,"fas","fa-users","fa-3x","text-primary","mb-3"],[1,"text-primary"],[1,"text-muted","mb-0"],["class","text-center py-5",4,"ngIf"],["class","alert alert-danger text-center",4,"ngIf"],[4,"ngIf"],["modalId","addRelationshipModal",3,"member1","familyMembers","relationshipAdded","relationshipError",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-3","text-muted"],[1,"alert","alert-danger","text-center"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"btn","btn-outline-danger","mt-2","d-block","mx-auto",3,"click"],[1,"fas","fa-redo","me-1"],[1,"fas","fa-user-plus","fa-4x","text-muted","mb-4"],[1,"text-muted"],[1,"lead","text-muted","mb-4"],["routerLink","/families",1,"btn","btn-primary","btn-lg"],[1,"fas","fa-home","me-2"],["id","familyTabs","role","tablist",1,"nav","nav-tabs","nav-fill","mb-4"],["class","nav-item","role","presentation",4,"ngFor","ngForOf"],["id","familyTabsContent",1,"tab-content"],["class","tab-pane fade","role","tabpanel",3,"show","active","id",4,"ngFor","ngForOf"],["role","presentation",1,"nav-item"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link",3,"id"],[1,"badge","bg-secondary","ms-2"],["role","tabpanel",1,"tab-pane","fade",3,"id"],[1,"row","g-4"],["class","col-lg-4 col-md-6",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-lg-4","col-md-6"],[1,"card","h-100","shadow-sm","member-card"],[1,"card-header","bg-light"],[1,"card-title","mb-1"],[1,"d-flex","align-items-center","text-muted","small"],[1,"fas","me-1"],[1,"me-2"],["class","badge bg-secondary",4,"ngIf"],[1,"card-body"],[1,"mb-3"],["class","d-flex align-items-center mb-2",4,"ngIf"],["class","card-text text-muted small",4,"ngIf"],[1,"card-footer","bg-light","d-flex","gap-2"],[1,"btn","btn-outline-primary","btn-sm","flex-fill",3,"routerLink"],[1,"fas","fa-eye","me-1"],["class","btn btn-outline-success btn-sm flex-fill","data-bs-toggle","modal","data-bs-target","#addRelationshipModal",3,"click",4,"ngIf"],[1,"badge","bg-secondary"],[1,"d-flex","align-items-center","mb-2"],[1,"fas","fa-birthday-cake","text-warning","me-2"],[1,"fas","fa-map-marker-alt","text-danger","me-2"],["class","d-flex flex-column gap-2",4,"ngIf","ngIfElse"],[1,"d-flex","flex-column","gap-2"],["class","relationship-group",4,"ngFor","ngForOf"],[1,"relationship-group"],[1,"badge","bg-success"],[1,"fas","fa-users","me-1"],[1,"badge","bg-warning","text-dark"],[1,"fas","fa-question-circle","me-1"],[1,"card-text","text-muted","small"],["data-bs-toggle","modal","data-bs-target","#addRelationshipModal",1,"btn","btn-outline-success","btn-sm","flex-fill",3,"click"],[1,"fas","fa-link","me-1"],["modalId","addRelationshipModal",3,"relationshipAdded","relationshipError","member1","familyMembers"]],template:function(e,t){e&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h1",5),d(5,"i",6),u(6,"\u041C\u043E\u0438\u0442\u0435 \u0440\u043E\u0434\u043D\u0438\u043D\u0438 "),a(),r(7,"p",7),u(8,"\u0412\u0441\u0438\u0447\u043A\u0438 \u0440\u043E\u0434\u043D\u0438\u043D\u0438 \u043E\u0442 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u0430\u0442\u0430 \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u0430\u0442\u0430"),a(),r(9,"div",8)(10,"div",9),d(11,"i",10),r(12,"h4",11),u(13,"\u0414\u043E\u0431\u0440\u0435 \u0434\u043E\u0448\u043B\u0438 \u0432 \u0441\u0435\u043C\u0435\u0439\u043D\u0430\u0442\u0430 \u043C\u0440\u0435\u0436\u0430!"),a(),r(14,"p",12),u(15,"\u0420\u0430\u0437\u0433\u043B\u0435\u0434\u0430\u0439\u0442\u0435 \u0440\u043E\u0434\u043D\u0438\u043D\u0438\u0442\u0435 \u043E\u0442 \u0432\u0441\u0438\u0447\u043A\u0438 \u0441\u0435\u043C\u0435\u0439\u0441\u0442\u0432\u0430 \u0438 \u0434\u043E\u0431\u0430\u0432\u044F\u0439\u0442\u0435 \u043D\u043E\u0432\u0438 \u0432\u0440\u044A\u0437\u043A\u0438 \u043C\u0435\u0436\u0434\u0443 \u0442\u044F\u0445."),a()()()(),c(16,Ie,6,0,"div",13)(17,De,6,1,"div",14)(18,je,3,2,"div",15),a()()(),c(19,Ye,1,2,"app-add-relationship-bootstrap",16)),e&2&&(o(16),l("ngIf",t.isLoading),o(),l("ngIf",t.error),o(),l("ngIf",!t.isLoading&&!t.error),o(),l("ngIf",t.selectedMember))},dependencies:[A,B,O,X,N,W,K,Q],styles:[".member-card[_ngcontent-%COMP%]{transition:transform .2s ease-in-out,box-shadow .2s ease-in-out}.member-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 25px #00000026!important}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{border-radius:.5rem .5rem 0 0;margin-bottom:-1px}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;border-color:var(--bs-primary) var(--bs-primary) var(--bs-border-color)}.alert[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]{border-radius:.75rem}.card-header[_ngcontent-%COMP%]{border-radius:.75rem .75rem 0 0!important}.card-footer[_ngcontent-%COMP%]{border-radius:0 0 .75rem .75rem!important}.badge[_ngcontent-%COMP%]{border-radius:.5rem}.relationship-group[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{display:block;width:100%;text-align:left;font-size:.8rem;padding:.5rem .75rem;margin-bottom:.25rem}.relationship-group[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]:last-child{margin-bottom:0}.btn[_ngcontent-%COMP%]{border-radius:.5rem}.display-4[_ngcontent-%COMP%]{font-weight:600}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:0 15px}.nav-tabs[_ngcontent-%COMP%]{flex-direction:column}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{text-align:center;margin-bottom:2px;border-radius:.5rem}}"]})};export{be as MyMembersBootstrapComponent};

import{A as p,o as h}from"./chunk-Q7HNEB5Z.js";import{Q as b,U as o,Y as c,c as u,g as n,n as a,x as m}from"./chunk-AKCSPO7I.js";var M=class l{constructor(e){this.http=e}apiUrl=`${p.apiUrl}/api/member`;membersSubject=new n([]);selectedMemberSubject=new n(null);members$=this.membersSubject.asObservable();selectedMember$=this.selectedMemberSubject.asObservable();getMembersByFamily(e){return this.http.get(`${this.apiUrl}/family/${e}`).pipe(b(t=>this.membersSubject.next(t)),m(this.handleError("getMembersByFamily",[])))}getMemberById(e){return this.http.get(`${this.apiUrl}/${e}`).pipe(b(t=>this.selectedMemberSubject.next(t)),m(this.handleError("getMemberById")))}createMember(e){return this.http.post(this.apiUrl,e).pipe(b(t=>{let r=this.membersSubject.value;this.membersSubject.next([...r,t])}),m(this.handleError("createMember")))}updateMember(e,t){return this.http.put(`${this.apiUrl}/${e}`,t).pipe(b(r=>{let i=this.membersSubject.value,s=i.findIndex(d=>d.id===e);s!==-1&&(i[s]=r,this.membersSubject.next([...i])),this.selectedMemberSubject.value?.id===e&&this.selectedMemberSubject.next(r)}),m(this.handleError("updateMember")))}deleteMember(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(a(()=>{let r=this.membersSubject.value.filter(i=>i.id!==e);return this.membersSubject.next(r),this.selectedMemberSubject.value?.id===e&&this.selectedMemberSubject.next(null),!0}),m(this.handleError("deleteMember",!1)))}getLivingMembers(){return this.members$.pipe(a(e=>e.filter(t=>!t.dateOfDeath)))}getDeceasedMembers(){return this.members$.pipe(a(e=>e.filter(t=>t.dateOfDeath)))}getMembersByGender(e){return this.members$.pipe(a(t=>t.filter(r=>r.gender.toLowerCase()===e.toLowerCase())))}searchMembers(e){return e.trim()?this.members$.pipe(a(t=>t.filter(r=>`${r.firstName} ${r.middleName||""} ${r.lastName}`.toLowerCase().includes(e.toLowerCase())))):this.members$}getMembersByAgeRange(e,t){return this.members$.pipe(a(r=>r.filter(i=>{if(!i.dateOfBirth)return!1;let s=this.calculateAge(new Date(i.dateOfBirth),i.dateOfDeath?new Date(i.dateOfDeath):new Date);return s>=e&&s<=t})))}getBirthdaysThisMonth(){let e=new Date().getMonth();return this.members$.pipe(a(t=>t.filter(r=>r.dateOfBirth?new Date(r.dateOfBirth).getMonth()===e:!1)))}calculateAge(e,t=new Date){let r=t.getFullYear()-e.getFullYear(),i=t.getMonth()-e.getMonth();return i<0||i===0&&t.getDate()<e.getDate()?r-1:r}clearSelectedMember(){this.selectedMemberSubject.next(null)}clearMembers(){this.membersSubject.next([])}handleError(e="operation",t){return r=>(console.error(`${e} failed: ${r.message}`),new u(i=>{t!==void 0&&i.next(t),i.complete()}))}static \u0275fac=function(t){return new(t||l)(c(h))};static \u0275prov=o({token:l,factory:l.\u0275fac,providedIn:"root"})};export{M as a};
